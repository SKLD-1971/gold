<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Center</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        :root {
            --staff-color: #FFD700;
            --support-color: #7289DA;
            --promoter-color: #ff4081;
            --danger-color: #e74c3c;
            --danger-glow: rgba(231, 76, 60, 0.4);
            --success-color: #2ecc71;
            --success-glow: rgba(46, 204, 113, 0.4);
            --waiting-color: #3498db;
            --waiting-glow: rgba(52, 152, 219, 0.4);
            --background-start: #0d1a2f;
            --background-end: #040a18;
            --surface-color: rgba(10, 20, 40, 0.65);
            --primary-color: #89b4fa;
            --glow-color: rgba(137, 180, 250, 0.5);
            --text-primary: #cdd6f4;
            --text-secondary: #a6adc8;
            --border-color: rgba(137, 180, 250, 0.2);
            --input-bg: rgba(5, 10, 25, 0.7);
            --container-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 25px var(--glow-color);
            --border-radius: 16px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom, var(--background-start), var(--background-end));
            color: var(--text-primary);
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            margin: 0; padding: 20px; overflow: hidden; position: relative;
        }
        
        #snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .snowflake { position: absolute; background: white; border-radius: 50%; opacity: 0.8; }
        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(0vw); }
            100% { transform: translateY(110vh) translateX(5vw); }
        }

        .container {
            background: var(--surface-color); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 40px;
            width: 100%; max-width: 800px; box-shadow: var(--container-shadow); z-index: 1;
            max-height: 90vh; overflow-y: auto; transition: all 0.5s ease;
        }
        
        .page-section { display: none; } .page-section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo-container img { max-width: 150px; border-radius: 50%; filter: drop-shadow(0 0 15px var(--glow-color)); }
        
        #selection-page .subtitle { text-align: center; color: var(--text-secondary); margin-bottom: 30px; font-size: 1.1em; }
        .selection-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        
        .selection-card { display: flex; align-items: center; gap: 20px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 12px; padding: 25px; cursor: pointer; transition: all 0.3s ease; }
        .selection-card:hover { transform: translateY(-5px); border-color: var(--primary-color); box-shadow: 0 5px 20px rgba(137, 180, 250, 0.3); }
        .selection-card .icon { flex-shrink: 0; width: 40px; height: 40px; display:flex; justify-content:center; align-items:center; }
        .selection-card h2 { margin: 0 0 5px 0; color: var(--text-primary); } .selection-card p { margin: 0; color: var(--text-secondary); }

        label { display: block; margin-bottom: 10px; font-weight: 600; color: var(--text-secondary); }
        textarea, input, select { width: 100%; padding: 14px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 8px; font-size: 1em; color: var(--text-primary); box-sizing: border-box; transition: all 0.3s ease; }
        textarea:focus, input:focus, select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 15px var(--glow-color); }
        select { appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23cdd6f4%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 1rem center; background-size: .7em; padding-right: 2.5rem; }
        .form-header, .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .form-header h1, .page-header h1 { margin: 0; text-align: left; font-size: 2em; color: var(--primary-color); text-shadow: 0 0 10px var(--glow-color); }
        
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 16px; border: none; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1.1em; font-weight: 700; transition: all 0.3s ease; }
        .btn:disabled { cursor: not-allowed; filter: grayscale(50%); opacity: 0.7; }
        .btn-primary { background: var(--primary-color); color: var(--background-start); box-shadow: 0 0 20px var(--glow-color); }
        .btn-primary:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 5px 25px var(--glow-color); }
        .btn-secondary { background: none; border: 1px solid var(--border-color); color: var(--text-secondary); padding: 8px 16px; font-size: 0.9em; width: auto; }
        
        .fixed-buttons-container { position: fixed; z-index: 1001; }
        .top-right { top: 20px; right: 20px; }
        .bottom-right { bottom: 20px; right: 20px; }
        .fixed-btn { background: var(--surface-color); border: 1px solid var(--border-color); width: 50px; height: 50px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); backdrop-filter: blur(10px); transition: all 0.3s ease; color: var(--text-primary); }
        .fixed-btn:hover { border-color: var(--primary-color); transform: scale(1.1); }

        #admin-panel { padding: 0; border: none; }
        .admin-layout, .webhook-editor-layout { display: flex; gap: 20px; min-height: 500px; }
        .admin-sidebar { width: 220px; flex-shrink: 0; display: flex; flex-direction: column; }
        .admin-nav-btn { display: block; width: 100%; text-align: left; background: none; border: none; color: var(--text-secondary); padding: 10px; border-radius: 6px; cursor: pointer; font-size: 1em; margin-bottom: 5px; }
        .admin-nav-btn:hover, .admin-nav-btn.active { background: var(--primary-color); color: var(--background-start); }
        .admin-content { flex-grow: 1; max-height: 65vh; overflow-y: auto;}
        .admin-section { display: none; } .admin-section.active { display: block; }
        .btn-danger { background: rgba(231, 76, 60, 0.2); color: var(--danger-color); border: 1px solid var(--danger-color); }
        .btn-danger:hover { box-shadow: 0 0 15px var(--danger-glow); }
        
        .webhook-editor-tabs { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        .webhook-tab { padding: 10px 15px; background: none; border: none; color: var(--text-secondary); cursor: pointer; border-radius: 6px 6px 0 0; }
        .webhook-tab.active { background: var(--surface-color); border: 1px solid var(--border-color); border-bottom: 1px solid var(--surface-color); color: var(--primary-color); }
        .discord-preview-container { width: 350px; flex-shrink: 0; background-color: #36393f; border-radius: 8px; padding: 16px; }
        #preview-avatar { width: 40px; height: 40px; border-radius: 50%; background-color: #7289da; object-fit: cover; }
        #preview-username { font-weight: 600; color: #fff; }
        .discord-embed { background-color: #2f3136; border-radius: 4px; border-left: 4px solid; padding: 12px; }
        #preview-embed-title { color: #fff; font-weight: 700; margin: 0 0 8px 0; }
        .discord-embed-field strong { color: #b9bbbe; font-size: 0.9em; }
        .discord-embed-field p { color: #dcddde; margin: 0; background: #202225; padding: 4px; border-radius: 3px; }

        .editor-question-item { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; }
        .editor-question-item input { flex-grow: 1; }
        .editor-question-item select { width: 120px; flex-shrink: 0; }
        .editor-question-item .btn-danger { width: 40px; height: 40px; padding: 0; font-size: 1.2em; flex-shrink: 0; display:flex; justify-content:center; align-items:center; }
        #editor-selection-buttons { display: flex; flex-direction: column; gap: 10px; }
        
        .submission-item, .status-result-item { background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 15px; }
        .submission-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom:10px; border-bottom:1px solid var(--border-color); }
        .status-header { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; padding-bottom:10px; border-bottom:1px solid var(--border-color); }
        .status-header .icon { display:flex; align-items:center; justify-content:center; }
        .status-header .icon svg { width: 24px; height: 24px; }
        .status-header h3 { margin: 0; font-size: 1.5em; }
        .status-accepted h3 { color: var(--success-color); }
        .status-rejected h3 { color: var(--danger-color); }
        .status-waiting h3 { color: var(--waiting-color); }
        .answer-item { margin-bottom: 12px; }
        .answer-item strong { color: var(--text-secondary); display: block; margin-bottom: 4px; }
        .answer-item p { margin: 0; background-color: var(--input-bg); padding: 10px; border-radius: 6px; }

        .app-status-indicator { text-align: center; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-weight: 600; }
        .app-status-open { background: var(--success-glow); border: 1px solid var(--success-color); color: var(--success-color); }
        .app-status-closed { background: var(--danger-glow); border: 1px solid var(--danger-color); color: var(--danger-color); }

        /* Toggle Switch CSS */
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--danger-color); transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success-color); }
        input:checked + .slider:before { transform: translateX(26px); }
    </style>
</head>
<body>
    <!-- Status Icons SVG Definitions -->
    <svg width="0" height="0" style="position:absolute">
      <defs>
        <symbol id="icon-accepted" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></symbol>
        <symbol id="icon-rejected" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"></path></symbol>
        <symbol id="icon-waiting" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"></path></symbol>
      </defs>
    </svg>

    <div id="snow-container"></div>
    <div class="fixed-buttons-container top-right">
        <div class="fixed-btn" onclick="showPage('login-page')" title="Admin Login"><svg fill="currentColor" viewBox="0 0 20 20" width="24"><path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 12a1 1 0 100-2 1 1 0 000 2z"></path></svg></div>
    </div>
    <div class="fixed-buttons-container bottom-right">
        <a href="https://discord.gg/42AjuqEDZs" target="_blank" class="fixed-btn" title="Join our Discord"><svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.36981C18.699 3.50425 16.961 2.85318 15.121 2.42725C15.033 2.65653 14.921 2.91207 14.823 3.14999C13.069 2.82563 11.233 2.82563 9.479 3.14999C9.381 2.91207 9.269 2.65653 9.181 2.42725C7.341 2.85318 5.603 3.50425 3.985 4.36981C0.465 8.42385 -0.444 12.3526 0.15 16.208C1.974 17.6892 4.029 18.6669 6.22 19.2739C6.444 18.9863 6.645 18.6872 6.822 18.3765C6.262 18.1472 5.726 17.8817 5.228 17.5855C5.166 17.5492 5.11 17.4918 5.068 17.4208C5.011 17.2016 4.978 16.9746 4.978 16.7453C4.978 16.7027 4.981 16.6602 4.981 16.6176C7.942 18.2398 11.333 18.7342 14.659 17.9933C15.229 18.7852 16.039 19.4632 17.065 19.9723C17.213 20.0433 17.369 20.0961 17.532 20.1347C19.721 19.2981 21.782 17.9701 23.486 16.208C24.516 11.9332 23.543 7.89218 20.317 4.36981ZM8.02 13.6396C7.031 13.6396 6.22 12.8179 6.22 11.8183C6.22 10.8187 7.017 10 8.02 10C9.023 10 9.82 10.8187 9.82 11.8183C9.82 12.8179 9.023 13.6396 8.02 13.6396ZM16.22 13.6396C15.231 13.6396 14.42 12.8179 14.42 11.8183C14.42 10.8187 15.217 10 16.22 10C17.223 10 18.02 10.8187 18.02 11.8183C18.02 12.8179 17.223 13.6396 16.22 13.6396Z"></path></svg></a>
    </div>
    <div class="container">
        <div id="selection-page" class="page-section active">
            <div class="logo-container"><img src="" alt="Logo"></div>
            <div id="application-status-header"></div>
            <p class="subtitle"></p>
            <div class="selection-grid"></div>
            <button class="btn btn-secondary" onclick="showPage('status-check-page')" style="margin-top: 20px; width:100%;">Check Application Status</button>
        </div>
        <div id="login-page" class="page-section">
            <div class="page-header"><h1>KEY</h1><button class="btn btn-secondary" onclick="showSelection()">Back</button></div>
            <div style="margin-bottom: 1rem;"><input type="password" id="dev-key" placeholder="Enter Developer Key" autocomplete="off" onkeydown="if(event.key==='Enter')handleDevLogin()"></div>
            <button class="btn btn-primary" onclick="handleDevLogin()">Enter</button>
        </div>
         <div id="status-check-page" class="page-section">
            <div class="page-header"><h1>Check Status</h1><button class="btn btn-secondary" onclick="showSelection()">Back</button></div>
            <div style="margin-bottom: 1rem;"><input type="text" id="status-check-discord-id" placeholder="Enter Your Discord ID (e.g., user#0001)"></div>
            <button class="btn btn-primary" onclick="checkUserStatus()">Check My Applications</button>
            <div id="status-results" style="margin-top: 20px;"></div>
        </div>
        <div id="admin-panel" class="page-section">
            <div class="page-header"><h1>Admin Panel</h1><button class="btn btn-secondary" onclick="showSelection()">Logout</button></div>
            <div class="admin-layout">
                <div class="admin-sidebar">
                    <div>
                        <h3>Management</h3>
                        <button class="admin-nav-btn active" data-target="admin-submissions">Submissions</button>
                        <button class="admin-nav-btn" data-target="admin-editor">Application Editor</button>
                        <button class="admin-nav-btn" data-target="admin-webhooks">Webhook Editor</button>
                        <button class="admin-nav-btn" data-target="admin-theme">Theme & Settings</button>
                    </div>
                    <div style="margin-top: auto;">
                        <button class="btn btn-danger" onclick="clearAllSubmissions()">Clear All Submissions</button>
                        <button class="btn btn-danger" onclick="resetAllData()" style="margin-top:10px;">Reset All Settings</button>
                    </div>
                </div>
                <div class="admin-content">
                    <div id="admin-submissions" class="admin-section active">
                         <h2>Submissions</h2>
                         <div id="submissions-container"></div>
                    </div>
                    <div id="admin-webhooks" class="admin-section">
                        <div class="webhook-editor-layout">
                           <div class="webhook-editor-controls" style="flex: 1;">
                               <div class="webhook-editor-tabs"></div>
                               <div id="webhook-editor-container"></div>
                               <button class="btn btn-primary" id="save-webhook-btn" onclick="saveAllSettings(this)" style="margin-top: 20px;">Save All Settings</button>
                           </div>
                           <div class="discord-preview-container">
                                <h3>Live Preview</h3>
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                    <img id="preview-avatar" src="">
                                    <span id="preview-username">Application Bot</span>
                                </div>
                                <div class="discord-embed" id="preview-embed">
                                    <h4 id="preview-embed-title">New Staff Application</h4>
                                    <div class="discord-embed-field"><strong>Your Discord ID & Tag</strong><p>user#0001</p></div>
                                </div>
                           </div>
                        </div>
                    </div>
                    <div id="admin-editor" class="admin-section">
                        <h2>Application Editor</h2>
                        <div id="editor-selection-buttons"></div>
                        <div id="application-editor-view" style="display: none;"></div>
                    </div>
                    <div id="admin-theme" class="admin-section">
                        <h2>Theme & General Settings</h2>
                        <div style="margin-bottom: 1.5rem;">
                            <label>Application Status</label>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <span style="color:var(--text-secondary)">Closed</span>
                                <label class="switch">
                                    <input type="checkbox" id="theme-applicationsOpen">
                                    <span class="slider"></span>
                                </label>
                                <span style="color:var(--text-primary)">Open</span>
                            </div>
                        </div>
                        <div style="margin-bottom: 1rem;"><label>Logo Image URL</label><input type="text" id="theme-logoUrl"></div>
                        <div style="margin-bottom: 1.5rem;"><label>Homepage Subtitle</label><input type="text" id="theme-subtitle"></div>
                        <h3>Color System</h3>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div><label>Primary Color</label><input type="color" id="theme-primaryColor" style="padding:0; height:40px; width:100%; background: none;"></div>
                            <div><label>Glow Color</label><input type="color" id="theme-glowColor" style="padding:0; height:40px; width:100%; background: none;"></div>
                            <div><label>Background Start</label><input type="color" id="theme-backgroundStart" style="padding:0; height:40px; width:100%; background: none;"></div>
                            <div><label>Background End</label><input type="color" id="theme-backgroundEnd" style="padding:0; height:40px; width:100%; background: none;"></div>
                        </div>
                         <button class="btn btn-primary" onclick="saveAllSettings(this)" style="margin-top: 20px;">Save All Settings</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="form-container" class="page-section"></div>
    </div>
    
    <script>
    // ===================================================================================
    //  CONFIGURATION - PASTE YOUR JSONBIN DETAILS HERE
    // ===================================================================================
    const JSONBIN_CONFIG = {
        API_KEY: "$2a$10$a/FFzBDimef5bKwM/mYYs.IP4ih4e8nOykqDGNm8iU0cnQ4YG8vOy", // This is your X-Master-Key
        BIN_ID: "6914699943b1c97be9a8acc6",
        BIN_URL: function() { return `https://api.jsonbin.io/v3/b/${this.BIN_ID}/latest` },
        BIN_WRITE_URL: function() { return `https://api.jsonbin.io/v3/b/${this.BIN_ID}` }
    };
    const DEV_KEY = "98123GOLD-PS#$";
    const SUBMISSION_COOLDOWN_HOURS = 72; // 3 days
    // ===================================================================================

    let siteSettings;
    let originalSiteSettings; 
    let countdownInterval;

    const defaultSettings = {
        theme: {
            logoUrl: "https://media.discordapp.net/attachments/1210718340449042473/1438107990074069052/Goldsnow.png",
            subtitle: "Select the path you wish to apply for, traveler.",
            primaryColor: "#89b4fa",
            glowColor: "rgba(137, 180, 250, 0.5)",
            backgroundStart: "#0d1a2f",
            backgroundEnd: "#040a18",
            applicationsOpen: true,
        },
        logWebhooks: { visitUrl: "", adminLogUrl: "" },
        submissions: {}, // Holds all application submissions
        appConfigs: {
            support: { 
                webhookUrl: "", username: "Support Bot", avatarUrl: "https://media.discordapp.net/attachments/1210718340449042473/1438107990074069052/Goldsnow.png", embedColor: "#7289DA", embedTitle: "New {role} Application", 
                title: "Support", icon: `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="40"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`, color: "var(--support-color)", 
                desc: "Handle player issues, questions, and conflicts.", 
                questions: [
                    { label: "Your Discord ID (e.g., user#0001)", type: "text" },
                    { label: "How will you handle a situation where a player got scammed?", type: "textarea" },
                    { label: "What will you do if you see another staff member abuse?", type: "textarea" },
                    { label: "What kind of proof will you accept if a victim provides you it?", type: "textarea" }
                ] 
            },
            staff: { 
                webhookUrl: "", username: "Staff Bot", avatarUrl: "https://media.discordapp.net/attachments/1210718340449042473/1438107990074069052/Goldsnow.png", embedColor: "#FFD700", embedTitle: "New {role} Application", 
                title: "Staff", icon: `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="40"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>`, color: "var(--staff-color)", 
                desc: "Enforce rules, moderate, and manage events.", 
                questions: [
                    { label: "Your Discord ID (e.g., user#0001)", type: "text" },
                    { label: "How will you handle a situation where a player got scammed?", type: "textarea" },
                    { label: "What will you do if you see another staff member abuse?", type: "textarea" },
                    { label: "What do you do if you notice a moderator abusing his/hers title?", type: "textarea" }
                ] 
            },
            promoter: { 
                webhookUrl: "", username: "Promoter Bot", avatarUrl: "https://media.discordapp.net/attachments/1210718340449042473/1438107990074069052/Goldsnow.png", embedColor: "#ff4081", embedTitle: "New {role} Application", 
                title: "YouTuber / Promoter", icon: `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="40"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>`, color: "var(--promoter-color)", 
                desc: "Create content and build hype for the server.", 
                questions: [
                    { label: "Your Discord ID (e.g., user#0001)", type: "text" },
                    { label: "Link to your primary content channel (YouTube, Twitch, etc.).", type: "text" },
                    { label: "Describe the type of content you plan to create for our server.", type: "textarea" }
                ] 
            }
        }
    };

    function applyTheme(settings) {
        const theme = settings.theme || defaultSettings.theme;
        const root = document.documentElement;
        root.style.setProperty('--primary-color', theme.primaryColor);
        root.style.setProperty('--glow-color', theme.glowColor);
        root.style.setProperty('--background-start', theme.backgroundStart);
        root.style.setProperty('--background-end', theme.backgroundEnd);
        document.querySelector('.logo-container img').src = theme.logoUrl;
        document.querySelector('#selection-page .subtitle').textContent = theme.subtitle;
    }

    async function loadDataFromStorage(forceFresh = false) {
        if (!JSONBIN_CONFIG.API_KEY.startsWith('$2') || !JSONBIN_CONFIG.BIN_ID) {
            console.warn("JSONBin config is missing. Using default settings. Changes will not be saved online.");
            siteSettings = JSON.parse(localStorage.getItem('siteSettingsBackup')) || JSON.parse(JSON.stringify(defaultSettings));
            originalSiteSettings = JSON.parse(JSON.stringify(siteSettings));
            return;
        }
        if (siteSettings && !forceFresh) return; 

        try {
            const response = await fetch(JSONBIN_CONFIG.BIN_URL(), {
                headers: { 'X-Master-Key': JSONBIN_CONFIG.API_KEY, 'X-Bin-Meta': 'false' }
            });
            if (!response.ok) throw new Error(`Failed to fetch settings: ${response.statusText}`);
            
            const data = await response.json();
            const record = (data && Object.keys(data).length > 0) ? data : JSON.parse(JSON.stringify(defaultSettings));
            siteSettings = { ...JSON.parse(JSON.stringify(defaultSettings)), ...record };
            originalSiteSettings = JSON.parse(JSON.stringify(siteSettings));
            localStorage.setItem('siteSettingsBackup', JSON.stringify(siteSettings));
        } catch (error) {
            console.error("Error loading settings from JSONBin. Using local or default settings.", error);
            siteSettings = JSON.parse(localStorage.getItem('siteSettingsBackup')) || JSON.parse(JSON.stringify(defaultSettings));
            originalSiteSettings = JSON.parse(JSON.stringify(siteSettings));
            alert("Could not load online settings. Check your JSONBin config and console for errors.");
        } finally {
            applyTheme(siteSettings);
        }
    }

    async function saveDataToStorage(saveButton) {
        if (!JSONBIN_CONFIG.API_KEY.startsWith('$2') || !JSONBIN_CONFIG.BIN_ID) {
            alert("Cannot save. JSONBin config is missing in the script.");
            return false;
        }
        if (saveButton) { saveButton.disabled = true; saveButton.textContent = "Saving..."; }
        try {
            const response = await fetch(JSONBIN_CONFIG.BIN_WRITE_URL(), {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_CONFIG.API_KEY },
                body: JSON.stringify(siteSettings)
            });
            if (!response.ok) throw new Error(`Failed to save settings: ${response.statusText}`);
            originalSiteSettings = JSON.parse(JSON.stringify(siteSettings));
            localStorage.setItem('siteSettingsBackup', JSON.stringify(siteSettings));
            return true;
        } catch (error) {
            console.error("Error saving settings to JSONBin.", error);
            alert("Error saving settings online. Check console for details.");
            return false;
        } finally {
            if (saveButton) { saveButton.disabled = false; saveButton.textContent = "Save All Settings"; }
        }
    }
    
    async function adminLog(title, description, color = 3447003) {
        if (siteSettings.logWebhooks && siteSettings.logWebhooks.adminLogUrl) {
            await simpleWebhookSend(siteSettings.logWebhooks.adminLogUrl, {
                username: "Admin Logger",
                avatar_url: "https://i.imgur.com/gLaLga1.png",
                embeds: [{ title, description, color, timestamp: new Date().toISOString() }]
            });
        }
    }

    async function saveAllSettings(saveButton) {
        const activeNav = document.querySelector('.admin-nav-btn.active').dataset.target;

        if (activeNav === 'admin-webhooks') {
            const activeTab = document.getElementById('webhook-editor-container')?.dataset.activeTab;
            if (activeTab) {
                const inputs = document.querySelectorAll(`#webhook-editor-container [data-key]`);
                if (activeTab === 'logs') {
                    siteSettings.logWebhooks = siteSettings.logWebhooks || {};
                    inputs.forEach(input => siteSettings.logWebhooks[input.dataset.key] = input.value);
                } else if (siteSettings.appConfigs[activeTab]) {
                    inputs.forEach(input => siteSettings.appConfigs[activeTab][input.dataset.key] = input.value);
                }
            }
        }
        await adminLog("üõ†Ô∏è Site Settings Updated", "An admin has updated the site configuration.");
        const success = await saveDataToStorage(saveButton);
        if (success) {
            alert('All settings saved and synced online!');
            await loadDataFromStorage(true);
            setupHomepage();
            if (document.getElementById('admin-panel').classList.contains('active')) setupAdminPanel();
        }
    }

    document.addEventListener('DOMContentLoaded', async () => {
        createSnowflakes();
        const container = document.querySelector('.container');
        container.style.opacity = '0.5'; container.style.pointerEvents = 'none';
        await loadDataFromStorage();
        setupHomepage();
        container.style.opacity = '1'; container.style.pointerEvents = 'auto';
    });
    
    function createSnowflakes() {
        const container = document.getElementById('snow-container');
        if (container.children.length > 0) return;
        for (let i = 0; i < 150; i++) {
            const sf = document.createElement('div'); sf.className = 'snowflake';
            const size = Math.random() * 4 + 1;
            sf.style.width = `${size}px`; sf.style.height = `${size}px`; sf.style.left = `${Math.random() * 100}vw`;
            sf.style.animation = `fall ${Math.random() * 10 + 10}s linear ${Math.random() * 10}s infinite`;
            container.appendChild(sf);
        }
    }
    
    function showPage(pageId) { document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active')); document.getElementById(pageId).classList.add('active'); }
    function showSelection() { showPage('selection-page'); setupHomepage(); }
    
    function handleDevLogin() {
        const keyInput = document.getElementById('dev-key');
        if (keyInput.value === DEV_KEY) {
            showPage('admin-panel'); setupAdminPanel(); keyInput.value = '';
        } else { alert('Incorrect Developer Key.'); keyInput.value = ''; }
    }
    
    async function simpleWebhookSend(url, embed) {
        if (!url || !url.startsWith('https://discord.com/api/webhooks/')) return;
        try { await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(embed) });
        } catch (error) { console.error("Webhook send failed:", error); }
    }

    function generateUUID() { return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16) ); }

    async function submitApplication(formType) {
        const form = document.getElementById(`app-form-${formType}`);
        form.querySelector('button[type="submit"]').disabled = true;

        const config = siteSettings.appConfigs[formType];
        const answers = Array.from(form.querySelectorAll('[data-question-label]')).map(el => ({
            question: el.dataset.questionLabel,
            answer: el.value
        }));
        
        const discordId = answers[0]?.answer.trim();
        if (!discordId) { alert('Discord ID is required to submit.'); return; }

        await loadDataFromStorage(true);

        const submissionId = generateUUID();
        const newSubmission = {
            id: submissionId, appType: formType, status: 'waiting',
            timestamp: new Date().toISOString(), answers: answers
        };

        if (!siteSettings.submissions[discordId]) siteSettings.submissions[discordId] = [];
        siteSettings.submissions[discordId].push(newSubmission);
        
        const success = await saveDataToStorage(form.querySelector('button[type="submit"]'));
        if (success) {
            localStorage.setItem(`cooldown_${formType}`, new Date().getTime());
            await adminLog("üìù New Application Submitted", `**Applicant:** ${discordId}\n**For:** ${config.title}`, 5763719);
            
            if (config.webhookUrl) {
                const fields = answers.map(a => ({ name: a.question, value: "```" + a.answer + "```" }));
                await simpleWebhookSend(config.webhookUrl, {
                    username: config.username, avatar_url: config.avatarUrl,
                    embeds: [{ title: config.embedTitle.replace('{role}', config.title), color: parseInt(config.embedColor.substring(1), 16), fields, timestamp: new Date().toISOString() }]
                });
            }
            alert('Success! Your application has been submitted.');
            showSelection();
        } else {
            alert('There was an error submitting your application. Please try again.');
            form.querySelector('button[type="submit"]').disabled = false;
        }
    }
    
    function setupHomepage() {
        const grid = document.querySelector('#selection-page .selection-grid');
        const statusHeader = document.getElementById('application-status-header');
        grid.innerHTML = '';
        if (!siteSettings) return;

        const isOpen = siteSettings.theme.applicationsOpen;
        statusHeader.innerHTML = `<div class="app-status-indicator ${isOpen ? 'app-status-open' : 'app-status-closed'}">
            Applications are currently ${isOpen ? 'Open' : 'Closed'}
        </div>`;
        
        if (isOpen) {
            Object.keys(siteSettings.appConfigs).forEach(key => {
                const app = siteSettings.appConfigs[key];
                grid.innerHTML += `<div class="selection-card" onclick="renderForm('${key}')"><div class="icon" style="color: ${app.color || '#fff'}">${app.icon}</div><div><h2>${app.title}</h2><p>${app.desc}</p></div></div>`;
            });
        }
        applyTheme(siteSettings);
    }

    function renderForm(formType) {
        showPage('form-container');
        const data = siteSettings.appConfigs[formType];
        const lastSubmissionTime = localStorage.getItem(`cooldown_${formType}`);
        const cooldownEndTime = lastSubmissionTime ? parseInt(lastSubmissionTime) + (SUBMISSION_COOLDOWN_HOURS * 60 * 60 * 1000) : 0;
        const now = new Date().getTime();

        let formHTML = `<div class="form-header"><h1>${data.title} Application</h1><button class="btn btn-secondary" onclick="showSelection()">Back</button></div>`;

        if (now < cooldownEndTime) {
            formHTML += `<div style="text-align:center;"><h3>You have already applied for this position.</h3><p>You can apply again in:</p><h2 id="cooldown-timer"></h2></div>`;
            document.getElementById('form-container').innerHTML = formHTML;
            
            clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                const remaining = cooldownEndTime - new Date().getTime();
                if (remaining <= 0) { clearInterval(countdownInterval); renderForm(formType); } 
                else {
                    const h = Math.floor(remaining / 3600000);
                    const m = Math.floor((remaining % 3600000) / 60000);
                    const s = Math.floor((remaining % 60000) / 1000);
                    document.getElementById('cooldown-timer').textContent = `${h}h ${m}m ${s}s`;
                }
            }, 1000);
        } else {
            formHTML += `<form id="app-form-${formType}">`;
            data.questions.forEach((q, i) => {
                const qId = `${formType.substring(0,3)}-q${i}`;
                const inputElement = (q.type === 'textarea') ? 
                    `<textarea id="${qId}" rows="5" required data-question-label="${q.label}"></textarea>` : 
                    `<input type="text" id="${qId}" required data-question-label="${q.label}">`;
                formHTML += `<div class="question-group" style="margin-bottom: 1rem;"><label for="${qId}">${q.label}</label>${inputElement}</div>`;
            });
            formHTML += `<button type="submit" class="btn btn-primary">Submit ${data.title} Application</button></form>`;
            document.getElementById('form-container').innerHTML = formHTML;
            document.getElementById(`app-form-${formType}`).addEventListener('submit', (e) => { e.preventDefault(); submitApplication(formType); });
        }
    }

    async function checkUserStatus() {
        const discordId = document.getElementById('status-check-discord-id').value.trim();
        const resultsContainer = document.getElementById('status-results');
        if (!discordId) { resultsContainer.innerHTML = `<p>Please enter your Discord ID.</p>`; return; }

        resultsContainer.innerHTML = `<p>Checking...</p>`;
        await loadDataFromStorage(true);
        
        const userSubmissions = siteSettings.submissions[discordId];
        if (!userSubmissions || userSubmissions.length === 0) {
            resultsContainer.innerHTML = `<p>No applications found for "${discordId}".</p>`;
            return;
        }

        resultsContainer.innerHTML = userSubmissions.map(sub => {
            const appConfig = siteSettings.appConfigs[sub.appType];
            const date = new Date(sub.timestamp).toLocaleString();
            const statusCapitalized = sub.status.charAt(0).toUpperCase() + sub.status.slice(1);
            return `
                <div class="status-result-item">
                    <div class="status-header status-${sub.status}">
                        <div class="icon"><svg><use xlink:href="#icon-${sub.status}"></use></svg></div>
                        <h3>${statusCapitalized}</h3>
                    </div>
                    <h4>${appConfig.title} Application</h4>
                    <p><strong>Submitted On:</strong> ${date}</p>
                </div>`;
        }).join('');
    }

    function setupAdminPanel() {
        document.querySelectorAll('.admin-nav-btn').forEach(btn => btn.addEventListener('click', (e) => {
            document.querySelectorAll('.admin-nav-btn, .admin-section').forEach(el => el.classList.remove('active'));
            e.currentTarget.classList.add('active');
            const targetId = e.currentTarget.dataset.target;
            document.getElementById(targetId).classList.add('active');
            if(targetId === 'admin-submissions') renderSubmissionsAdminView();
        }));
        renderSubmissionsAdminView();
        renderWebhookEditor(Object.keys(siteSettings.appConfigs)[0] || 'logs');
        setupApplicationEditorList();
        renderThemeEditor();
    }
    
    function renderSubmissionsAdminView() {
        const container = document.getElementById('submissions-container');
        container.innerHTML = 'Loading submissions...';
        
        const allSubmissions = Object.entries(siteSettings.submissions || {}).flatMap(([discordId, subs]) => 
            subs.map(sub => ({ ...sub, discordId }))
        ).sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));

        if (allSubmissions.length === 0) {
            container.innerHTML = '<p>No submissions yet.</p>'; return;
        }

        container.innerHTML = allSubmissions.map(sub => {
            const appConfig = siteSettings.appConfigs[sub.appType];
            const date = new Date(sub.timestamp).toLocaleString();
            return `
                <div class="submission-item">
                    <div class="submission-header">
                        <h4>${appConfig.title} by ${sub.discordId}</h4>
                        <select onchange="updateSubmissionStatus('${sub.discordId}', '${sub.id}', this.value, '${sub.status}')">
                            <option value="waiting" ${sub.status === 'waiting' ? 'selected' : ''}>Waiting</option>
                            <option value="accepted" ${sub.status === 'accepted' ? 'selected' : ''}>Accept</option>
                            <option value="rejected" ${sub.status === 'rejected' ? 'selected' : ''}>Reject</option>
                        </select>
                    </div>
                    <p><strong>Submitted On:</strong> ${date}</p>
                    <div class="answers-container">
                        ${sub.answers.map(a => `<div class="answer-item"><strong>${a.question}</strong><p>${a.answer}</p></div>`).join('')}
                    </div>
                </div>`;
        }).join('');
    }

    async function updateSubmissionStatus(discordId, submissionId, newStatus, oldStatus) {
        if (newStatus === oldStatus) return;
        const submissionIndex = siteSettings.submissions[discordId].findIndex(s => s.id === submissionId);
        if(submissionIndex > -1) {
            siteSettings.submissions[discordId][submissionIndex].status = newStatus;
            await saveDataToStorage(null);
            const appTitle = siteSettings.appConfigs[siteSettings.submissions[discordId][submissionIndex].appType].title;
            await adminLog(`üîÑ Application Status Changed`, `**Applicant:** ${discordId}\n**Application:** ${appTitle}\n**Status:** \`${oldStatus}\` ‚Üí \`${newStatus}\``, 15844367);
            renderSubmissionsAdminView(); // Refresh view
        }
    }

    function renderWebhookEditor(tabKey) {
        const tabsContainer = document.querySelector('.webhook-editor-tabs');
        tabsContainer.innerHTML = '';
        Object.keys(siteSettings.appConfigs).forEach(key => {
            tabsContainer.innerHTML += `<button class="webhook-tab" data-tab="${key}">${siteSettings.appConfigs[key].title}</button>`;
        });
        tabsContainer.innerHTML += `<button class="webhook-tab" data-tab="logs">Global Logs</button>`;
        document.querySelectorAll('.webhook-tab').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.tab === tabKey);
            tab.addEventListener('click', (e) => renderWebhookEditor(e.currentTarget.dataset.tab));
        });

        const container = document.getElementById('webhook-editor-container');
        let html = '';
        if (tabKey === 'logs') {
            const config = siteSettings.logWebhooks || {};
            html = `<h3>Global Logging</h3>
                    <div><label>Site Visit Log URL</label><input type="text" data-key="visitUrl" value="${config.visitUrl || ''}"></div>
                    <div><label>Admin Activity Log URL</label><input type="text" data-key="adminLogUrl" value="${config.adminLogUrl || ''}"></div>`;
        } else {
            const config = siteSettings.appConfigs[tabKey];
            if (!config) return;
            html = `<h3>${config.title} Settings</h3>
                    <div><label>Webhook URL</label><input type="text" data-key="webhookUrl" value="${config.webhookUrl || ''}"></div>
                    <div><label>Bot Name</label><input type="text" data-key="username" value="${config.username || ''}"></div>
                    <div><label>Bot Avatar URL</label><input type="text" data-key="avatarUrl" value="${config.avatarUrl || ''}"></div>
                    <div><label>Embed Color</label><input type="color" data-key="embedColor" value="${config.embedColor || '#ffffff'}" style="padding:0; height:40px; background: none;"></div>
                    <div><label>Embed Title</label><input type="text" data-key="embedTitle" value="${config.embedTitle || ''}"></div>`;
        }
        container.innerHTML = html;
        container.dataset.activeTab = tabKey;
        container.querySelectorAll('input').forEach(input => input.addEventListener('input', updateWebhookPreview));
        updateWebhookPreview();
    }

    function updateWebhookPreview() {
        const activeTab = document.getElementById('webhook-editor-container').dataset.activeTab;
        if (!activeTab || activeTab === 'logs' || !siteSettings.appConfigs[activeTab]) { 
            document.querySelector('.discord-preview-container').style.opacity = '0.5'; return; 
        }
        document.querySelector('.discord-preview-container').style.opacity = '1';
        const config = siteSettings.appConfigs[activeTab];
        const tempConfig = {};
        document.querySelectorAll(`#webhook-editor-container [data-key]`).forEach(input => tempConfig[input.dataset.key] = input.value);
        document.getElementById('preview-username').textContent = tempConfig.username || "Bot";
        document.getElementById('preview-avatar').src = tempConfig.avatarUrl || "";
        document.getElementById('preview-embed-title').textContent = (tempConfig.embedTitle || "").replace('{role}', config.title);
        document.getElementById('preview-embed').style.borderLeftColor = tempConfig.embedColor;
    }

    function renderThemeEditor() {
        const theme = siteSettings.theme || defaultSettings.theme;
        document.getElementById('theme-applicationsOpen').checked = theme.applicationsOpen;
        document.getElementById('theme-logoUrl').value = theme.logoUrl;
        document.getElementById('theme-subtitle').value = theme.subtitle;
        document.getElementById('theme-primaryColor').value = theme.primaryColor;
        document.getElementById('theme-glowColor').value = theme.glowColor;
        document.getElementById('theme-backgroundStart').value = theme.backgroundStart;
        document.getElementById('theme-backgroundEnd').value = theme.backgroundEnd;
        
        document.querySelectorAll('#admin-theme input').forEach(input => {
            input.addEventListener('input', () => {
                const key = input.id.replace('theme-', '');
                const value = input.type === 'checkbox' ? input.checked : input.value;
                const oldStatus = siteSettings.theme.applicationsOpen;

                siteSettings.theme[key] = value;
                
                if (key === 'applicationsOpen' && value !== oldStatus) {
                    adminLog("üì¢ Public Applications Toggled", `Applications have been ${value ? 'Opened' : 'Closed'}.`, value ? 3066993 : 15158332);
                }
                applyTheme(siteSettings);
            });
        });
    }
    
    async function clearAllSubmissions() {
        if (confirm('Are you sure you want to delete ALL submissions? This cannot be undone.')) {
            siteSettings.submissions = {};
            const success = await saveDataToStorage(null);
            if (success) { 
                alert('All submissions cleared.');
                await adminLog("üóëÔ∏è Submissions Cleared", "All applications have been permanently deleted.", 15105570);
                renderSubmissionsAdminView(); 
            }
        }
    }

    async function resetAllData() {
        if (confirm('Are you sure you want to reset ALL online settings to the original default? This will also clear all submissions. This cannot be undone.')) {
            siteSettings = JSON.parse(JSON.stringify(defaultSettings));
            const success = await saveDataToStorage(null);
            if (success) {
                await adminLog("üö® FACTORY RESET üö®", "All site settings and submissions have been reset to default.", 12320855);
                location.reload();
            }
        }
    }
    
    function setupApplicationEditorList() {
        const container = document.getElementById('editor-selection-buttons');
        container.innerHTML = '<h3>Select Application to Edit</h3>';
        Object.keys(siteSettings.appConfigs).forEach(key => {
            container.innerHTML += `<button class="btn btn-secondary" onclick="renderApplicationEditor('${key}')">Edit ${siteSettings.appConfigs[key].title}</button>`;
        });
        container.innerHTML += `<hr style="border-color: var(--border-color); margin: 20px 0;"><button class="btn btn-primary" onclick="addApplicationType()">+ Add New Application Type</button>`;
        cancelEdit();
    }

    function renderApplicationEditor(appKey) { 
        const data = siteSettings.appConfigs[appKey];
        const view = document.getElementById('application-editor-view');
        document.getElementById('editor-selection-buttons').style.display = 'none';
        
        let questionsHTML = data.questions.map(q => `
            <div class="editor-question-item">
                <input class="question-label-input" value="${q.label.replace(/"/g, '&quot;')}">
                <select class="question-type-select">
                    <option value="text" ${q.type === 'text' ? 'selected' : ''}>Text</option>
                    <option value="textarea" ${q.type === 'textarea' ? 'selected' : ''}>Textarea</option>
                </select>
                <button class="btn btn-danger" onclick="this.parentElement.remove()" title="Delete Question">‚úñ</button>
            </div>`).join('');

        view.innerHTML = `
            <h3>Editing: ${data.title}</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div><label>Title</label><input id="edit-title" value="${data.title.replace(/"/g, '&quot;')}"></div>
                <div><label>Description</label><input id="edit-desc" value="${data.desc.replace(/"/g, '&quot;')}"></div>
            </div>
            <div><label>Icon (SVG Code)</label><textarea id="edit-icon" rows="3">${data.icon}</textarea></div>
            <h4 style="margin-top: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Questions</h4>
            <div id="question-editor-container" style="margin-top: 1.5rem;">${questionsHTML}</div>
            <div style="display:flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-secondary" onclick="addQuestionToEditor()">+ Add Question</button>
                <button class="btn btn-primary" id="save-app-btn" style="flex-grow: 1;" onclick="saveApplicationChanges('${appKey}', this)">Save Changes</button>
                <button class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
            </div>
            <hr style="border-color: var(--border-color); margin: 20px 0;">
            <button class="btn btn-danger" onclick="deleteApplication('${appKey}', this)">Delete This Application</button>
        `;
        view.style.display = 'block';
    }

    function addQuestionToEditor() { 
        const container = document.getElementById('question-editor-container');
        const newItem = document.createElement('div');
        newItem.className = 'editor-question-item';
        newItem.innerHTML = `
            <input class="question-label-input" placeholder="New Question Label">
            <select class="question-type-select"><option value="text">Text</option><option value="textarea" selected>Textarea</option></select>
            <button class="btn btn-danger" onclick="this.parentElement.remove()" title="Delete Question">‚úñ</button>`;
        container.appendChild(newItem);
    }

    function cancelEdit() { 
        document.getElementById('application-editor-view').style.display = 'none'; 
        document.getElementById('editor-selection-buttons').style.display = 'block'; 
    }

    async function saveApplicationChanges(appKey, saveButton) {
        const config = siteSettings.appConfigs[appKey];
        config.title = document.getElementById('edit-title').value;
        config.desc = document.getElementById('edit-desc').value;
        config.icon = document.getElementById('edit-icon').value;
        
        const questions = [];
        document.querySelectorAll('.editor-question-item').forEach((item) => {
            const label = item.querySelector('.question-label-input').value;
            const type = item.querySelector('.question-type-select').value;
            if (label) { questions.push({ label, type }); }
        });
        config.questions = questions;

        await saveAllSettings(saveButton);
        setupApplicationEditorList();
    }

    async function addApplicationType() {
        const key = prompt("Enter a unique short key for the new application (e.g., 'moderator', no spaces).");
        if (key && !siteSettings.appConfigs[key]) {
            siteSettings.appConfigs[key] = JSON.parse(JSON.stringify(defaultSettings.appConfigs.support));
            siteSettings.appConfigs[key].title = "New Application";
            siteSettings.appConfigs[key].desc = "A new role to apply for.";
            siteSettings.appConfigs[key].questions = [{label: "Your Discord ID (e.g., user#0001)", type: "text"}];
            await saveAllSettings(null);
            setupApplicationEditorList();
            renderApplicationEditor(key);
        } else if (key) {
            alert("Error: That key already exists.");
        }
    }

    async function deleteApplication(appKey, button) {
        if (confirm(`Are you sure you want to permanently delete the '${siteSettings.appConfigs[appKey].title}' application?`)) {
            delete siteSettings.appConfigs[appKey];
            await saveAllSettings(button);
            setupApplicationEditorList();
            setupAdminPanel();
        }
    }
    </script>
</body>
</html>
