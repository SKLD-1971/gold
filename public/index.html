<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Center</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        :root {
            --staff-color: #FFD700;
            --support-color: #7289DA;
            --promoter-color: #ff4081;
            --danger-color: #e74c3c;
            --danger-glow: rgba(231, 76, 60, 0.4);
            --background-start: #0d1a2f;
            --background-end: #040a18;
            --surface-color: rgba(10, 20, 40, 0.65);
            --primary-color: #89b4fa;
            --glow-color: rgba(137, 180, 250, 0.5);
            --text-primary: #cdd6f4;
            --text-secondary: #a6adc8;
            --border-color: rgba(137, 180, 250, 0.2);
            --input-bg: rgba(5, 10, 25, 0.7);
            --container-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 25px var(--glow-color);
            --border-radius: 16px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom, var(--background-start), var(--background-end));
            color: var(--text-primary);
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            margin: 0; padding: 20px; overflow: hidden; position: relative;
        }
        
        #snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .snowflake { position: absolute; background: white; border-radius: 50%; opacity: 0.8; }
        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(0vw); }
            100% { transform: translateY(110vh) translateX(5vw); }
        }

        .container {
            background: var(--surface-color); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 40px;
            width: 100%; max-width: 800px; box-shadow: var(--container-shadow); z-index: 1;
            max-height: 90vh; overflow-y: auto; transition: all 0.5s ease;
        }
        
        .page-section { display: none; } .page-section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        #application-off-page { text-align: center; }
        #application-off-page h1 { font-size: 2.5em; color: var(--primary-color); text-shadow: 0 0 15px var(--glow-color); }
        #application-off-page p { font-size: 1.2em; color: var(--text-secondary); }

        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo-container img { max-width: 150px; border-radius: 50%; filter: drop-shadow(0 0 15px var(--glow-color)); }
        
        #selection-page .subtitle { text-align: center; color: var(--text-secondary); margin-bottom: 30px; font-size: 1.1em; }
        .selection-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        
        .selection-card { display: flex; align-items: center; gap: 20px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 12px; padding: 25px; cursor: pointer; transition: all 0.3s ease; }
        .selection-card:hover { transform: translateY(-5px); border-color: var(--primary-color); box-shadow: 0 5px 20px rgba(137, 180, 250, 0.3); }
        .selection-card .icon { flex-shrink: 0; width: 40px; height: 40px; display:flex; justify-content:center; align-items:center; }
        .selection-card h2 { margin: 0 0 5px 0; color: var(--text-primary); } .selection-card p { margin: 0; color: var(--text-secondary); }

        label { display: block; margin-bottom: 10px; font-weight: 600; color: var(--text-secondary); }
        textarea, input, select { width: 100%; padding: 14px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 8px; font-size: 1em; color: var(--text-primary); box-sizing: border-box; transition: all 0.3s ease; }
        textarea:focus, input:focus, select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 15px var(--glow-color); }
        select { appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23cdd6f4%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 1rem center; background-size: .7em; padding-right: 2.5rem; }
        .form-header, .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .form-header h1, .page-header h1 { margin: 0; text-align: left; font-size: 2em; color: var(--primary-color); text-shadow: 0 0 10px var(--glow-color); }
        
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 16px; border: none; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1.1em; font-weight: 700; transition: all 0.3s ease; }
        .btn:disabled { cursor: not-allowed; filter: grayscale(50%); opacity: 0.7; }
        .btn-primary { background: var(--primary-color); color: var(--background-start); box-shadow: 0 0 20px var(--glow-color); }
        .btn-primary:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 5px 25px var(--glow-color); }
        .btn-secondary { background: none; border: 1px solid var(--border-color); color: var(--text-secondary); padding: 8px 16px; font-size: 0.9em; width: auto; }
        
        .fixed-buttons-container { position: fixed; z-index: 1001; display:flex; flex-direction:column; gap: 15px; }
        .top-right { top: 20px; right: 20px; } .bottom-right { bottom: 20px; right: 20px; } .bottom-left { bottom: 20px; left: 20px; }
        .fixed-btn { background: var(--surface-color); border: 1px solid var(--border-color); width: 50px; height: 50px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); backdrop-filter: blur(10px); transition: all 0.3s ease; color: var(--text-primary); position: relative; overflow: hidden; }
        .fixed-btn svg, .fixed-btn img { width: 24px; height: 24px; z-index: 2; }
        .fixed-btn:hover { border-color: var(--primary-color); transform: scale(1.1); box-shadow: 0 0 20px var(--glow-color);}

        #dev-btn {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
            border-color: rgba(255, 215, 0, 0.5);
            backdrop-filter: blur(10px);
            color: #FFD700;
        }
        #dev-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 235, 150, 0.4), transparent); transition: left 0.7s; }
        #dev-btn:hover::before { left: 120%; }
        #dev-btn:hover { box-shadow: 0 0 25px rgba(255, 215, 0, 0.6); }

        #discord-btn { background: #5865F220; border-color: #5865F280; color: #fff; }
        #discord-btn:hover { box-shadow: 0 0 25px #5865F2; background: #5865F240; border-color: #5865F2; }
        
        #admin-panel { padding: 0; border: none; }
        .admin-layout { display: flex; gap: 20px; min-height: 500px; }
        .admin-sidebar { width: 220px; flex-shrink: 0; display:flex; flex-direction:column; }
        .admin-nav-btn { display: flex; align-items:center; gap: 8px; width: 100%; text-align: left; background: none; border: none; color: var(--text-secondary); padding: 10px; border-radius: 6px; cursor: pointer; font-size: 1em; margin-bottom: 5px; }
        .admin-nav-btn:hover, .admin-nav-btn.active { background: var(--primary-color); color: var(--background-start); }
        .admin-content { flex-grow: 1; max-height: 65vh; overflow-y: auto;}
        .admin-section { display: none; } .admin-section.active { display: block; }
        .btn-danger { background: rgba(231, 76, 60, 0.2); color: var(--danger-color); border: 1px solid var(--danger-color); }
        .btn-danger:hover { box-shadow: 0 0 15px var(--danger-glow); }
        
        .editor-question-item { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; cursor: grab; user-select: none; }
        .editor-question-item.dragging { opacity: 0.5; background: var(--primary-color); }
        .editor-question-item input { flex-grow: 1; }
        .editor-question-item select { width: 120px; flex-shrink: 0; }
        .editor-question-item .btn-danger { width: 40px; height: 40px; padding: 0; font-size: 1.2em; flex-shrink: 0; display:flex; justify-content:center; align-items:center; }
        
        #staff-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); z-index: 1002; display: none; justify-content: center; align-items: center; }
        .staff-modal-content { background: var(--surface-color); border: 1px solid var(--border-color); padding: 30px; border-radius: var(--border-radius); width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; position:relative;}
        .staff-role-group h3 { border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-top: 20px; display: flex; align-items: center; gap: 10px; }
        .staff-role-group h3 .role-icon { width: 24px; height: 24px; }
        .staff-member { display: flex; align-items: center; gap: 15px; background: var(--input-bg); padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        .staff-member img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
        .role-tag { padding: 4px 8px; border-radius: 5px; font-size: 0.9em; font-weight: 600; color: white; text-shadow: 1px 1px 2px black; }
        .role-tag.glass { background: rgba(255,255,255,0.1); backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2);}
        @keyframes shine { 0% { background-position: -200%; } 100% { background-position: 200%; } }
        .role-tag.shine { background-size: 200% auto; animation: shine 3s linear infinite; }
    </style>
</head>
<body>
    <div id="snow-container"></div>

    <div class="fixed-buttons-container top-right">
        <div id="dev-btn" class="fixed-btn" onclick="showPage('login-page')" title="Admin Login"></div>
    </div>
    <div class="fixed-buttons-container bottom-left">
        <div id="staff-btn" class="fixed-btn" onclick="document.getElementById('staff-modal').style.display='flex'" title="Our Staff"></div>
    </div>
    <div class="fixed-buttons-container bottom-right">
        <a id="discord-btn" href="https://discord.gg/42AjuqEDZs" target="_blank" class="fixed-btn" title="Join our Discord"></a>
    </div>

    <div class="container">
        <div id="application-off-page" class="page-section">
            <div class="logo-container"><img src="" alt="Logo"></div>
            <h1></h1>
            <p></p>
        </div>
        <div id="selection-page" class="page-section active">
            <div class="logo-container"><img src="" alt="Logo"></div>
            <p class="subtitle"></p>
            <div class="selection-grid"></div>
        </div>
        <div id="login-page" class="page-section">
            <div class="page-header"><h1>Developer Sanctum</h1><button class="btn btn-secondary" onclick="showSelection()">Back</button></div>
            <div style="margin-bottom: 1rem;"><input type="password" id="dev-key" placeholder="Enter Developer Key" autocomplete="off" onkeydown="if(event.key==='Enter')handleDevLogin()"></div>
            <button class="btn btn-primary" onclick="handleDevLogin()">Enter Sanctum</button>
        </div>
        <div id="admin-panel" class="page-section">
            <div class="page-header"><h1>Admin Panel</h1><button class="btn btn-secondary" onclick="showSelection()">Logout</button></div>
            <div class="admin-layout">
                <div class="admin-sidebar">
                    <div>
                        <h3>Management</h3>
                        <button class="admin-nav-btn active" data-target="admin-theme">Theme & Settings</button>
                        <button class="admin-nav-btn" data-target="admin-editor">Application Editor</button>
                        <button class="admin-nav-btn" data-target="admin-staff">Staff & Roles</button>
                    </div>
                    <div style="margin-top: auto;">
                        <button class="btn btn-primary" onclick="saveAllSettings(this)" style="margin-bottom: 10px;">Save All Settings</button>
                        <button class="btn btn-danger" onclick="resetAllData()">Reset All Settings</button>
                    </div>
                </div>
                <div class="admin-content">
                    <div id="admin-theme" class="admin-section active">
                        <h2>Theme & General Settings</h2>
                        <div style="margin-bottom: 1rem;">
                            <label for="app-status-toggle">Application Status</label>
                            <select id="app-status-toggle"><option value="on">On (Open)</option><option value="off">Off (Closed)</option></select>
                        </div>
                        <div id="app-off-settings" style="display:none; margin-bottom: 1.5rem; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                             <label>Application Off Title</label><input type="text" id="theme-appOffTitle">
                             <label>Application Off Message</label><textarea id="theme-appOffMessage" rows="2"></textarea>
                        </div>
                        <div style="margin-bottom: 1rem;"><label>Logo Image URL</label><input type="text" id="theme-logoUrl"></div>
                        <div style="margin-bottom: 1.5rem;"><label>Homepage Subtitle</label><input type="text" id="theme-subtitle"></div>
                        <h3>Color System</h3>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div><label>Primary Color</label><input type="color" id="theme-primaryColor" style="padding:0; height:40px; width:100%; background: none;"></div>
                            <div><label>Glow Color</label><input type="color" id="theme-glowColor" style="padding:0; height:40px; width:100%; background: none;"></div>
                            <div><label>Background Start</label><input type="color" id="theme-backgroundStart" style="padding:0; height:40px; width:100%; background: none;"></div>
                            <div><label>Background End</label><input type="color" id="theme-backgroundEnd" style="padding:0; height:40px; width:100%; background: none;"></div>
                        </div>
                        <h3 style="margin-top: 1.5rem;">Button Settings</h3>
                         <p style="font-size:0.9em; color:var(--text-secondary); margin-top:-10px;">Upload an icon from your PC, or paste SVG code directly.</p>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                           <div><label>Dev Button Icon</label><input type="file" onchange="handleIconUpload('dev', this.files[0])" accept="image/*,.svg"><textarea id="theme-devBtnIcon" rows="2"></textarea></div>
                           <div><label>Dev Button Color</label><input type="color" id="theme-devBtnColor"></div>
                           <div><label>Discord Button Icon</label><input type="file" onchange="handleIconUpload('discord', this.files[0])" accept="image/*,.svg"><textarea id="theme-discordBtnIcon" rows="2"></textarea></div>
                           <div><label>Discord Button Color</label><input type="color" id="theme-discordBtnColor"></div>
                           <div><label>Staff Button Icon</label><input type="file" onchange="handleIconUpload('staff', this.files[0])" accept="image/*,.svg"><textarea id="theme-staffBtnIcon" rows="2"></textarea></div>
                           <div><label>Staff Button Color</label><input type="color" id="theme-staffBtnColor"></div>
                        </div>
                    </div>
                    <div id="admin-editor" class="admin-section">
                        <h2>Application Editor</h2>
                        <div id="editor-selection-buttons"></div>
                        <div id="application-editor-view" style="display: none;"></div>
                    </div>
                    <div id="admin-staff" class="admin-section"></div>
                </div>
            </div>
        </div>
        <div id="form-container" class="page-section"></div>
    </div>

    <div id="staff-modal">
        <div class="staff-modal-content">
            <button class="btn btn-secondary" style="position:absolute; top:15px; right:15px;" onclick="document.getElementById('staff-modal').style.display='none'">Close</button>
            <h2>Our Staff Team</h2>
            <div id="staff-roster-container"></div>
        </div>
    </div>
    
    <script>
    const JSONBIN_CONFIG = {
        API_KEY: "$2a$10$a/FFzBDimef5bKwM/mYYs.IP4ih4e8nOykqDGNm8iU0cnQ4YG8vOy",
        BIN_ID: "6914699943b1c97be9a8acc6",
        BIN_URL: function() { return `https://api.jsonbin.io/v3/b/${this.BIN_ID}/latest` },
        BIN_WRITE_URL: function() { return `https://api.jsonbin.io/v3/b/${this.BIN_ID}` }
    };

    let siteSettings;
    let originalSiteSettings; 

    const defaultSettings = {
        devKey: '98123GOLD-PS#$',
        appStatus: "on",
        theme: {
            logoUrl: "https://media.discordapp.net/attachments/1210718340449042473/1438107990074069052/Goldsnow.png",
            subtitle: "Select the path you wish to apply for, traveler.",
            appOffTitle: "Applications Are Currently Closed",
            appOffMessage: "Please check back later or join our Discord for updates.",
            primaryColor: "#89b4fa",
            glowColor: "rgba(137, 180, 250, 0.5)",
            backgroundStart: "#0d1a2f",
            backgroundEnd: "#040a18",
            buttons: {
                dev: { icon: `<svg fill="currentColor" viewBox="0 0 20 20" width="24"><path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 12a1 1 0 100-2 1 1 0 000 2z"></path></svg>`, color: "#FFD700" },
                discord: { icon: `<svg width="28" height="28" viewBox="0 0 245 195" fill="currentColor"><path d="M207.3,0.0 C207.3,0.0 200.3,3.3 194.3,9.0 C182.2,4.2 169.4,1.4 156.4,0.3 C156.1,0.3 155.7,0.4 155.4,0.5 C147.9,2.5 141.2,5.5 135.2,9.0 C117.8,4.7 99.8,4.7 82.5,9.0 C76.5,5.5 69.8,2.5 62.3,0.5 C62.0,0.4 61.6,0.3 61.3,0.3 C48.3,1.4 35.5,4.2 23.4,9.0 C17.4,3.3 10.4,0.0 10.4,0.0 C10.4,0.0 -3.4,22.0 0.4,65.2 C15.9,78.2 31.0,86.4 46.1,92.5 C45.9,93.4 45.7,94.3 45.6,95.1 C41.9,94.9 38.3,94.4 34.8,93.5 C34.5,93.4 34.2,93.5 34.0,93.7 C30.0,95.5 26.3,97.7 22.9,100.3 C22.7,100.4 22.6,100.6 22.6,100.9 C29.4,122.3 41.5,139.7 57.5,152.0 C57.7,152.2 58.0,152.3 58.3,152.2 C64.8,150.0 70.9,147.4 76.6,144.4 C76.9,144.2 77.1,143.9 77.0,143.6 C75.9,141.1 74.9,138.6 74.0,136.0 C73.9,135.8 73.6,135.7 73.4,135.8 C70.0,137.2 66.5,138.5 62.9,139.6 C62.6,139.7 62.3,139.6 62.1,139.3 C42.3,123.9 29.3,101.5 24.0,76.5 C24.0,76.5 24.1,76.5 24.1,76.5 C28.0,74.9 31.8,73.4 35.4,72.0 C35.7,71.9 36.0,72.0 36.1,72.3 C37.8,76.4 39.8,80.4 42.1,84.1 C42.2,84.4 42.5,84.5 42.8,84.4 C73.9,73.2 100.8,73.2 127.8,84.4 C128.1,84.5 128.4,84.4 128.5,84.1 C130.8,80.4 132.8,76.4 134.5,72.3 C134.6,72.0 134.9,71.9 135.2,72.0 C138.8,73.4 142.6,74.9 146.5,76.5 C146.5,76.5 146.6,76.5 146.6,76.5 C141.3,101.5 128.3,123.9 108.5,139.3 C108.3,139.6 108.0,139.7 107.7,139.6 C104.1,138.5 100.6,137.2 97.2,135.8 C96.9,135.7 96.7,135.8 96.6,136.0 C95.7,138.6 94.7,141.1 93.6,143.6 C93.5,143.9 93.7,144.2 94.0,144.4 C99.7,147.4 105.8,150.0 112.3,152.2 C112.6,152.3 112.9,152.2 113.1,152.0 C129.1,139.7 141.2,122.3 148.0,100.9 C148.0,100.6 147.9,100.4 147.7,100.3 C144.3,97.7 140.6,95.5 136.6,93.7 C136.4,93.5 136.1,93.4 135.8,93.5 C132.3,94.4 128.7,94.9 125.0,95.1 C124.9,94.3 124.7,93.4 124.5,92.5 C139.6,86.4 154.7,78.2 170.2,65.2 C174.0,22.0 161.2,0.0 161.2,0.0 C161.2,0.0 168.2,3.3 174.2,9.0 C186.3,4.2 199.1,1.4 212.1,0.3 C212.4,0.3 212.8,0.4 213.1,0.5 C220.6,2.5 227.3,5.5 233.3,9.0 C245.4,4.7 263.4,4.7 280.7,9.0 C286.7,5.5 293.4,2.5 300.9,0.5 C301.2,0.4 301.6,0.3 301.9,0.3 C314.9,1.4 327.7,4.2 339.8,9.0 C345.8,3.3 352.8,0.0 352.8,0.0 C352.8,0.0 366.6,22.0 362.8,65.2 C347.3,78.2 332.2,86.4 317.1,92.5 C317.3,93.4 317.5,94.3 317.6,95.1 C321.3,94.9 324.9,94.4 328.4,93.5 C328.7,93.4 329.0,93.5 329.2,93.7 C333.2,95.5 336.9,97.7 340.3,100.3 C340.5,100.4 340.6,100.6 340.6,100.9 C333.8,122.3 321.7,139.7 305.7,152.0 C305.5,152.2 305.2,152.3 304.9,152.2 C298.4,150.0 292.3,147.4 286.6,144.4 C286.3,144.2 286.1,143.9 286.2,143.6 C287.3,141.1 288.3,138.6 289.2,136.0 C289.3,135.8 289.6,135.7 289.8,135.8 C293.2,137.2 296.7,138.5 300.3,139.6 C300.6,139.7 300.9,139.6 301.1,139.3 C320.9,123.9 333.9,101.5 339.2,76.5 C339.2,76.5 339.1,76.5 339.1,76.5 C335.2,74.9 331.4,73.4 327.8,72.0 C327.5,71.9 327.2,72.0 327.1,72.3 C325.4,76.4 323.4,80.4 321.1,84.1 C321.0,84.4 320.7,84.5 320.4,84.4 C289.3,73.2 262.4,73.2 235.4,84.4 C235.1,84.5 234.8,84.4 234.7,84.1 C232.4,80.4 230.4,76.4 228.7,72.3 C228.6,72.0 228.3,71.9 228.0,72.0 C224.4,73.4 220.6,74.9 216.7,76.5 C216.7,76.5 216.6,76.5 216.6,76.5 C221.9,101.5 234.9,123.9 254.7,139.3 C254.9,139.6 255.2,139.7 255.5,139.6 C259.1,138.5 262.6,137.2 266.0,135.8 C266.3,135.7 266.5,135.8 266.6,136.0 C267.5,138.6 268.5,141.1 269.6,143.6 C269.7,143.9 269.5,144.2 269.2,144.4 C263.5,147.4 257.4,150.0 250.9,152.2 C250.6,152.3 250.3,152.2 250.1,152.0 C234.1,139.7 222.0,122.3 215.2,100.9 C215.2,100.6 215.3,100.4 215.5,100.3 C218.9,97.7 222.6,95.5 226.6,93.7 C226.8,93.5 227.1,93.4 227.4,93.5 C230.9,94.4 234.5,94.9 238.2,95.1 C238.3,94.3 238.5,93.4 238.7,92.5 C223.6,86.4 208.5,78.2 193.0,65.2 C189.2,22.0 202.0,0.0 202.0,0.0 L207.3,0.0 Z"></path></svg>`, color: "#5865F2"},
                staff: { icon: `<svg fill="currentColor" viewBox="0 0 20 20" width="24"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zm-3 4a5 5 0 00-5 5v1h10v-1a5 5 0 00-5-5zm2 5H3v-.34a3.33 3.33 0 013.33-3.33H8a3.33 3.33 0 013.33 3.33V15h-2zM15 6a3 3 0 11-6 0 3 3 0 016 0zm-3 4a5 5 0 00-5 5v1h10v-1a5 5 0 00-5-5z"></path></svg>`, color: "#3ba55c" }
            }
        },
        staff: {
            roles: [
                { id: 1, name: "Administrator", icon: "üëë", color: "linear-gradient(45deg, #ff5370, #ff869a)", shine: true, glass: false },
                { id: 2, name: "Moderator", icon: "üõ°Ô∏è", color: "#45b6fe", shine: false, glass: true }
            ],
            members: [
                { name: "Alpha", avatar: "https://cdn.discordapp.com/embed/avatars/0.png", roleId: 1 },
                { name: "Bravo", avatar: "https://cdn.discordapp.com/embed/avatars/1.png", roleId: 2 }
            ]
        },
        appConfigs: {
            support: { 
                webhookUrl: "", username: "Support Bot", avatarUrl: "https://media.discordapp.net/attachments/1210718340449042473/1438107990074069052/Goldsnow.png", embedColor: "#7289DA", embedTitle: "New {role} Application", 
                title: "Support", icon: `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="40"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`, color: "var(--support-color)", 
                desc: "Handle player issues, questions, and conflicts.", 
                questions: [
                    { label: "How will you handle a situation where a player got scammed?", type: "textarea" },
                    { label: "What will you do if you see another staff member abuse?", type: "textarea" },
                    { label: "What kind of proof will you accept if a victim provides you it?", type: "textarea" },
                ] 
            },
            staff: { 
                webhookUrl: "", username: "Staff Bot", avatarUrl: "https://media.discordapp.net/attachments/1210718340449042473/1438107990074069052/Goldsnow.png", embedColor: "#FFD700", embedTitle: "New {role} Application", 
                title: "Staff", icon: `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="40"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>`, color: "var(--staff-color)", 
                desc: "Enforce rules, moderate, and manage events.", 
                questions: [
                    { label: "How active can you be per day?", type: "text" },
                    { label: "What will you do if you saw a higher rank member abusing power?", type: "textarea" }
                ] 
            }
        }
    };
    
    function deepMerge(target, source) {
        for (const key in source) {
            if (source[key] instanceof Object && key in target && !Array.isArray(source[key])) {
                target[key] = deepMerge(target[key] || {}, source[key]);
            } else {
                target[key] = source[key];
            }
        }
        return target;
    }

    function applyTheme(settings) {
        const theme = settings.theme;
        const root = document.documentElement;
        root.style.setProperty('--primary-color', theme.primaryColor);
        root.style.setProperty('--glow-color', theme.glowColor);
        root.style.setProperty('--background-start', theme.backgroundStart);
        root.style.setProperty('--background-end', theme.backgroundEnd);
        
        document.querySelectorAll('.logo-container img').forEach(img => img.src = theme.logoUrl);
        
        if (settings.appStatus === 'off') {
            document.getElementById('application-off-page').querySelector('h1').textContent = theme.appOffTitle;
            document.getElementById('application-off-page').querySelector('p').textContent = theme.appOffMessage;
        } else {
            const subtitleP = document.querySelector('#selection-page .subtitle');
            if (subtitleP) subtitleP.textContent = theme.subtitle;
        }

        const devBtn = document.getElementById('dev-btn');
        devBtn.innerHTML = theme.buttons.dev.icon;
        devBtn.style.color = theme.buttons.dev.color;

        const discordBtn = document.getElementById('discord-btn');
        discordBtn.innerHTML = theme.buttons.discord.icon;
        discordBtn.style.color = theme.buttons.discord.color;
        discordBtn.style.borderColor = theme.buttons.discord.color + '80';
        discordBtn.style.background = theme.buttons.discord.color + '20';

        const staffBtn = document.getElementById('staff-btn');
        staffBtn.innerHTML = theme.buttons.staff.icon;
        staffBtn.style.color = theme.buttons.staff.color;
    }

    async function loadDataFromStorage() {
        if (!JSONBIN_CONFIG.API_KEY.startsWith('$2') || !JSONBIN_CONFIG.BIN_ID) {
            console.warn("JSONBin config is missing. Using default settings.");
            siteSettings = JSON.parse(JSON.stringify(defaultSettings));
            originalSiteSettings = JSON.parse(JSON.stringify(defaultSettings));
            return;
        }
        try {
            const response = await fetch(JSONBIN_CONFIG.BIN_URL(), { headers: { 'X-Master-Key': JSONBIN_CONFIG.API_KEY } });
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            const record = (data.record && Object.keys(data.record).length > 0) ? data.record : {};
            siteSettings = deepMerge(JSON.parse(JSON.stringify(defaultSettings)), record);
            originalSiteSettings = JSON.parse(JSON.stringify(siteSettings));
        } catch (error) {
            console.error("Error loading settings from JSONBin. Using default settings.", error);
            siteSettings = JSON.parse(JSON.stringify(defaultSettings));
            originalSiteSettings = JSON.parse(JSON.stringify(defaultSettings));
            alert("Could not load online settings.");
        }
    }

    async function saveDataToStorage(saveButton) {
        if (!JSONBIN_CONFIG.API_KEY.startsWith('$2') || !JSONBIN_CONFIG.BIN_ID) {
            alert("Cannot save. JSONBin config is missing."); return false;
        }
        if (saveButton) { saveButton.disabled = true; saveButton.textContent = "Saving..."; }
        try {
            const response = await fetch(JSONBIN_CONFIG.BIN_WRITE_URL(), {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_CONFIG.API_KEY },
                body: JSON.stringify(siteSettings)
            });
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            originalSiteSettings = JSON.parse(JSON.stringify(siteSettings));
            return true;
        } catch (error) {
            console.error("Error saving settings to JSONBin.", error); alert("Error saving settings online."); return false;
        } finally {
            if (saveButton) { saveButton.disabled = false; saveButton.textContent = "Save All Settings"; }
        }
    }

    async function saveAllSettings(saveButton) {
        const success = await saveDataToStorage(saveButton);
        if (success) {
            alert('All settings saved!');
            await loadDataFromStorage();
            applyTheme(siteSettings);
            setupHomepage();
            if (document.getElementById('admin-panel').classList.contains('active')) {
                setupAdminPanel();
            }
        }
    }
    
    document.addEventListener('DOMContentLoaded', async () => {
        createSnowflakes();
        const container = document.querySelector('.container');
        container.style.opacity = '0';
        await loadDataFromStorage();
        applyTheme(siteSettings);
        setupHomepage();
        renderStaffRoster();
        container.style.opacity = '1';
    });
    
    function createSnowflakes() {
        const container = document.getElementById('snow-container'); if (container.children.length > 0) return;
        for (let i = 0; i < 150; i++) {
            const snowflake = document.createElement('div'); snowflake.className = 'snowflake';
            const size = Math.random() * 4 + 1;
            snowflake.style.width = `${size}px`; snowflake.style.height = `${size}px`;
            snowflake.style.left = `${Math.random() * 100}vw`; snowflake.style.animationName = 'fall';
            snowflake.style.animationDuration = `${Math.random() * 10 + 10}s`;
            snowflake.style.animationDelay = `${Math.random() * 10}s`;
            snowflake.style.animationTimingFunction = 'linear'; snowflake.style.animationIterationCount = 'infinite';
            container.appendChild(snowflake);
        }
    }
    
    function showPage(pageId) { document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active')); document.getElementById(pageId).classList.add('active'); }
    function showForm(formType) { showPage('form-container'); renderForm(formType); }
    function showSelection() {
        if (siteSettings.appStatus === 'on') { showPage('selection-page'); } else { showPage('application-off-page'); }
    }
    
    function handleDevLogin() {
        const keyInput = document.getElementById('dev-key');
        if (keyInput.value === siteSettings.devKey) {
            showPage('admin-panel'); setupAdminPanel(); keyInput.value = '';
        } else { alert('Incorrect Developer Key.'); keyInput.value = ''; }
    }
    
    async function submitApplication(formType) {
        const config = siteSettings.appConfigs[formType]; if (!config.webhookUrl) { alert('Admin error: Submission webhook is not configured.'); return; }
        const fields = config.questions.map((q, i) => ({ name: q.label, value: "```" + document.getElementById(`app-q-${i}`).value + "```", inline: false }));
        const payload = {
            username: config.username, avatar_url: config.avatarUrl,
            embeds: [{ title: config.embedTitle.replace('{role}', config.title), color: parseInt(config.embedColor.substring(1), 16), fields: fields, timestamp: new Date().toISOString() }]
        };
        try { await fetch(config.webhookUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        } catch (error) { console.error("Webhook send failed:", error); }
        alert('Success! Your application has been submitted.'); showSelection();
    }
    
    function setupHomepage() {
        if (siteSettings.appStatus === 'off') { showPage('application-off-page'); return; }
        showPage('selection-page'); const grid = document.querySelector('#selection-page .selection-grid');
        grid.innerHTML = '';
        for (const key in siteSettings.appConfigs) {
            const app = siteSettings.appConfigs[key];
            grid.innerHTML += `<div class="selection-card" onclick="showForm('${key}')"><div class="icon" style="color: ${app.color || '#fff'}">${app.icon}</div><div><h2>${app.title}</h2><p>${app.desc}</p></div></div>`;
        }
    }

    function renderForm(formType) {
        const data = siteSettings.appConfigs[formType];
        let formHTML = `<div class="form-header"><h1>${data.title} Application</h1><button class="btn btn-secondary" onclick="showSelection()">Back</button></div><form id="app-form-${formType}">`;
        data.questions.forEach((q, i) => {
            const qId = `app-q-${i}`;
            formHTML += `<div class="question-group" style="margin-bottom: 1rem;"><label for="${qId}">${q.label}</label>`;
            formHTML += (q.type === 'textarea') ? `<textarea id="${qId}" rows="5" required></textarea>` : `<input type="text" id="${qId}" required>`;
            formHTML += `</div>`;
        });
        formHTML += `<button type="submit" class="btn btn-primary">Submit Application</button></form>`;
        document.getElementById('form-container').innerHTML = formHTML;
        document.getElementById(`app-form-${formType}`).addEventListener('submit', (e) => { e.preventDefault(); submitApplication(formType); });
    }

    function setupAdminPanel() {
        document.querySelectorAll('.admin-nav-btn').forEach(btn => {
            btn.onclick = (e) => {
                document.querySelectorAll('.admin-nav-btn, .admin-section').forEach(el => el.classList.remove('active'));
                e.currentTarget.classList.add('active');
                document.getElementById(e.currentTarget.dataset.target).classList.add('active');
            }
        });
        renderThemeEditor();
        setupApplicationEditorList();
        renderStaffEditor();
    }
    
    function renderThemeEditor() {
        const theme = siteSettings.theme;
        document.getElementById('app-status-toggle').value = siteSettings.appStatus;
        document.getElementById('theme-appOffTitle').value = theme.appOffTitle;
        document.getElementById('theme-appOffMessage').value = theme.appOffMessage;
        document.getElementById('theme-logoUrl').value = theme.logoUrl;
        document.getElementById('theme-subtitle').value = theme.subtitle;
        document.getElementById('theme-primaryColor').value = theme.primaryColor;
        document.getElementById('theme-glowColor').value = theme.glowColor;
        document.getElementById('theme-backgroundStart').value = theme.backgroundStart;
        document.getElementById('theme-backgroundEnd').value = theme.backgroundEnd;
        document.getElementById('theme-devBtnIcon').value = theme.buttons.dev.icon;
        document.getElementById('theme-devBtnColor').value = theme.buttons.dev.color;
        document.getElementById('theme-discordBtnIcon').value = theme.buttons.discord.icon;
        document.getElementById('theme-discordBtnColor').value = theme.buttons.discord.color;
        document.getElementById('theme-staffBtnIcon').value = theme.buttons.staff.icon;
        document.getElementById('theme-staffBtnColor').value = theme.buttons.staff.color;

        const toggleAppStatus = () => { document.getElementById('app-off-settings').style.display = document.getElementById('app-status-toggle').value === 'off' ? 'block' : 'none'; };
        toggleAppStatus();
        document.getElementById('app-status-toggle').onchange = toggleAppStatus;

        document.querySelectorAll('#admin-theme input, #admin-theme textarea, #admin-theme select').forEach(input => {
            input.oninput = () => {
                siteSettings.appStatus = document.getElementById('app-status-toggle').value;
                siteSettings.theme.appOffTitle = document.getElementById('theme-appOffTitle').value;
                siteSettings.theme.appOffMessage = document.getElementById('theme-appOffMessage').value;
                siteSettings.theme.logoUrl = document.getElementById('theme-logoUrl').value;
                siteSettings.theme.subtitle = document.getElementById('theme-subtitle').value;
                siteSettings.theme.primaryColor = document.getElementById('theme-primaryColor').value;
                siteSettings.theme.glowColor = document.getElementById('theme-glowColor').value;
                siteSettings.theme.backgroundStart = document.getElementById('theme-backgroundStart').value;
                siteSettings.theme.backgroundEnd = document.getElementById('theme-backgroundEnd').value;
                siteSettings.theme.buttons.dev.icon = document.getElementById('theme-devBtnIcon').value;
                siteSettings.theme.buttons.dev.color = document.getElementById('theme-devBtnColor').value;
                siteSettings.theme.buttons.discord.icon = document.getElementById('theme-discordBtnIcon').value;
                siteSettings.theme.buttons.discord.color = document.getElementById('theme-discordBtnColor').value;
                siteSettings.theme.buttons.staff.icon = document.getElementById('theme-staffBtnIcon').value;
                siteSettings.theme.buttons.staff.color = document.getElementById('theme-staffBtnColor').value;
                applyTheme(siteSettings);
            };
        });
    }

    function handleIconUpload(buttonKey, file) {
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            let content = e.target.result;
            const iconHtml = file.type.includes('svg') ? content : `<img src="${content}" style="width:24px; height:24px; border-radius:4px;">`;
            document.getElementById(`theme-${buttonKey}BtnIcon`).value = iconHtml;
            siteSettings.theme.buttons[buttonKey].icon = iconHtml;
            applyTheme(siteSettings);
        };
        if (file.type.includes('svg')) { reader.readAsText(file); } else { reader.readAsDataURL(file); }
    }
    
    function setupApplicationEditorList() {
        const container = document.getElementById('editor-selection-buttons');
        container.innerHTML = '<h3>Select Application to Edit</h3>';
        Object.keys(siteSettings.appConfigs).forEach(key => {
            container.innerHTML += `<button class="btn btn-secondary" onclick="renderApplicationEditor('${key}')">Edit ${siteSettings.appConfigs[key].title}</button>`;
        });
        container.innerHTML += `<hr style="border-color: var(--border-color); margin: 20px 0;"><button class="btn btn-primary" onclick="addApplicationType()">+ Add New Application</button>`;
        cancelEdit();
    }

    function renderApplicationEditor(appKey) { 
        const data = siteSettings.appConfigs[appKey];
        const view = document.getElementById('application-editor-view');
        document.getElementById('editor-selection-buttons').style.display = 'none';
        let questionsHTML = data.questions.map((q, i) => `
            <div class="editor-question-item" draggable="true" data-index="${i}">
                <input class="question-label-input" value="${q.label.replace(/"/g, '&quot;')}">
                <select class="question-type-select"><option value="text" ${q.type === 'text' ? 'selected' : ''}>Text</option><option value="textarea" ${q.type === 'textarea' ? 'selected' : ''}>Textarea</option></select>
                <button class="btn btn-danger" onclick="this.parentElement.remove()"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>
            </div>`).join('');
        view.innerHTML = `<h3>Editing: ${data.title}</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div><label>Title</label><input id="edit-title" value="${data.title.replace(/"/g, '&quot;')}"></div><div><label>Description</label><input id="edit-desc" value="${data.desc.replace(/"/g, '&quot;')}"></div>
            </div><div><label>Icon (SVG Code)</label><textarea id="edit-icon" rows="3">${data.icon}</textarea></div>
            <h4 style="margin-top: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Questions (Drag to Reorder)</h4>
            <div id="question-editor-container" style="margin-top: 1.5rem;">${questionsHTML}</div>
            <div style="display:flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-secondary" onclick="addQuestionToEditor()">+ Add Question</button>
                <button class="btn btn-primary" style="flex-grow: 1;" onclick="saveApplicationChanges('${appKey}', this)">Save Changes</button><button class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
            </div><hr style="border-color: var(--border-color); margin: 20px 0;"><button class="btn btn-danger" onclick="deleteApplication('${appKey}', this)">Delete This Application</button>`;
        view.style.display = 'block';
        makeQuestionsDraggable();
    }
    
    function makeQuestionsDraggable() {
        const container = document.getElementById('question-editor-container'); let draggedItem = null;
        container.addEventListener('dragstart', e => { if (e.target.classList.contains('editor-question-item')) { draggedItem = e.target; setTimeout(() => e.target.classList.add('dragging'), 0); } });
        container.addEventListener('dragend', () => { if(draggedItem) draggedItem.classList.remove('dragging'); draggedItem = null; });
        container.addEventListener('dragover', e => {
            e.preventDefault();
            const afterElement = [...container.querySelectorAll('.editor-question-item:not(.dragging)')].reduce((closest, child) => {
                const box = child.getBoundingClientRect(); const offset = e.clientY - box.top - box.height / 2;
                return (offset < 0 && offset > closest.offset) ? { offset: offset, element: child } : closest;
            }, { offset: Number.NEGATIVE_INFINITY }).element;
            if (afterElement == null) { container.appendChild(draggedItem); } else { container.insertBefore(draggedItem, afterElement); }
        });
    }

    function addQuestionToEditor() { 
        const container = document.getElementById('question-editor-container'); const newItem = document.createElement('div'); newItem.className = 'editor-question-item'; newItem.draggable = true;
        newItem.innerHTML = `<input class="question-label-input" placeholder="New Question Label"><select class="question-type-select"><option value="text">Text</option><option value="textarea" selected>Textarea</option></select><button class="btn btn-danger" onclick="this.parentElement.remove()"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>`;
        container.appendChild(newItem);
    }

    function cancelEdit() { document.getElementById('application-editor-view').style.display = 'none'; document.getElementById('editor-selection-buttons').style.display = 'block'; }

    async function saveApplicationChanges(appKey, saveButton) {
        const config = siteSettings.appConfigs[appKey];
        config.title = document.getElementById('edit-title').value;
        config.desc = document.getElementById('edit-desc').value;
        config.icon = document.getElementById('edit-icon').value;
        const questions = [];
        document.querySelectorAll('.editor-question-item').forEach(item => {
            const label = item.querySelector('.question-label-input').value; const type = item.querySelector('.question-type-select').value;
            if (label) questions.push({ label, type });
        });
        config.questions = questions;
        await saveAllSettings(saveButton); setupApplicationEditorList();
    }

    async function addApplicationType() {
        const key = prompt("Enter a unique short key for the new application (e.g., 'moderator', no spaces).");
        if (key && !siteSettings.appConfigs[key]) {
            siteSettings.appConfigs[key] = JSON.parse(JSON.stringify(defaultSettings.appConfigs.support));
            siteSettings.appConfigs[key].title = "New Application"; siteSettings.appConfigs[key].desc = "A new role to apply for.";
            siteSettings.appConfigs[key].questions = [{label: "Discord ID", type: "text"}];
            await saveAllSettings(null); setupApplicationEditorList(); renderApplicationEditor(key);
        } else if (key) { alert("Error: That key already exists."); }
    }

    async function deleteApplication(appKey, button) {
        if (confirm(`Delete the '${siteSettings.appConfigs[appKey].title}' application?`)) {
            delete siteSettings.appConfigs[appKey]; await saveAllSettings(button); setupApplicationEditorList();
        }
    }
    
    function renderStaffRoster() {
        const container = document.getElementById('staff-roster-container'); container.innerHTML = '';
        siteSettings.staff.roles.forEach(role => {
            const membersInRole = siteSettings.staff.members.filter(m => m.roleId === role.id);
            if (membersInRole.length === 0) return;
            let roleHTML = `<div class="staff-role-group"><h3><span class="role-icon">${role.icon}</span> ${role.name}</h3>`;
            membersInRole.forEach(member => {
                roleHTML += `<div class="staff-member"><img src="${member.avatar}"><div><h4>${member.name}</h4></div></div>`;
            });
            roleHTML += `</div>`;
            container.innerHTML += roleHTML;
        });
    }

    function renderStaffEditor() {
        const container = document.getElementById('admin-staff');
        const roles = siteSettings.staff.roles;
        const members = siteSettings.staff.members;
        
        let rolesHTML = '<h4>Roles</h4>' + roles.map(role => `
            <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:8px; margin-bottom:10px;">
                <input value="${role.name}" oninput="siteSettings.staff.roles.find(r=>r.id===${role.id}).name=this.value">
                <input value="${role.icon}" oninput="siteSettings.staff.roles.find(r=>r.id===${role.id}).icon=this.value" style="width:50px;">
                <input value="${role.color}" oninput="siteSettings.staff.roles.find(r=>r.id===${role.id}).color=this.value" placeholder="Color or Gradient">
                <label><input type="checkbox" ${role.shine ? 'checked' : ''} onchange="siteSettings.staff.roles.find(r=>r.id===${role.id}).shine=this.checked"> Shine</label>
                <label><input type="checkbox" ${role.glass ? 'checked' : ''} onchange="siteSettings.staff.roles.find(r=>r.id===${role.id}).glass=this.checked"> Glass</label>
                <button class="btn-danger" onclick="deleteRole(${role.id})">X</button>
            </div>`).join('') + '<button class="btn btn-secondary" onclick="addRole()">+ Add Role</button>';

        let membersHTML = '<h4 style="margin-top:20px;">Members</h4>' + members.map(member => `
            <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:8px; margin-bottom:10px;">
                <input value="${member.name}" oninput="siteSettings.staff.members.find(m=>m.name=='${member.name}').name=this.value">
                <input value="${member.avatar}" oninput="siteSettings.staff.members.find(m=>m.name=='${member.name}').avatar=this.value" placeholder="Avatar URL">
                <select onchange="siteSettings.staff.members.find(m=>m.name=='${member.name}').roleId=parseInt(this.value)">
                    ${roles.map(r => `<option value="${r.id}" ${member.roleId === r.id ? 'selected' : ''}>${r.name}</option>`).join('')}
                </select>
                <button class="btn-danger" onclick="deleteMember('${member.name}')">X</button>
            </div>`).join('') + '<button class="btn btn-secondary" onclick="addMember()">+ Add Member</button>';
        
        container.innerHTML = `<h2>Staff & Role Management</h2>${rolesHTML}${membersHTML}`;
    }
    
    function addRole() {
        const newId = Math.max(0, ...siteSettings.staff.roles.map(r => r.id)) + 1;
        siteSettings.staff.roles.push({ id: newId, name: "New Role", icon: "‚≠ê", color: "#ffffff", shine: false, glass: false });
        renderStaffEditor();
    }
    function deleteRole(roleId) {
        siteSettings.staff.roles = siteSettings.staff.roles.filter(r => r.id !== roleId);
        siteSettings.staff.members = siteSettings.staff.members.filter(m => m.roleId !== roleId);
        renderStaffEditor();
    }
    function addMember() {
        if (siteSettings.staff.roles.length === 0) { alert("Please create a role first."); return; }
        siteSettings.staff.members.push({ name: "New Member", avatar: "", roleId: siteSettings.staff.roles[0].id });
        renderStaffEditor();
    }
    function deleteMember(name) {
        siteSettings.staff.members = siteSettings.staff.members.filter(m => m.name !== name);
        renderStaffEditor();
    }
    
    async function resetAllData() {
        if (confirm('Are you sure you want to reset ALL settings? This cannot be undone.')) {
            siteSettings = JSON.parse(JSON.stringify(defaultSettings));
            if (await saveDataToStorage(document.querySelector('.btn-danger'))) {
                location.reload();
            }
        }
    }
    </script>
</body>
</html>
